package com.jsp.controller;

import java.io.IOException;

import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.jsp.action.Action;

public class DispatcherServlet extends HttpServlet {
	private HandlerMapper handlerMapper;
	
	@Override
	public void init(ServletConfig config) throws ServletException {
		String path = config.getInitParameter("url.properties");

		try {
			if (path != null) {
				handlerMapper = new HandlerMapper(path);
			} else {
				handlerMapper = new HandlerMapper();
			}

			System.out.println("[DispatcherServlet] handlerMapper Ж░ђ Вцђв╣ёвљўВЌѕВіхвІѕвІц.");
			
			
			
			System.out.println("\r\n" + 
					"РађРађРађРађРађРађРађРађРађРађРађРађРађРађРБђРБђРБђРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\r\n" + 
					"РађРађРађРађРађРађРађРађРађРађРАаРаћРаѕРаЂРађРађРађРаѕРаЅРањРацРАђРбђРАаРбёРањРаѕРаЅРаЅРаљРаѓРбёРађРађРађРађРађРађРађРађ\r\n" + 
					"РађРађРађРађРађРађРађРађРАаРаіРађРађРађРађРађРБђРБђРБђРБђРАђРађРаѕРбБРађРаЅРађРађРађРађРађРађРаЂРаАРађРађРађРађРађРађРађ\r\n" + 
					"РађРађРађРађРађРађРађРАћРађРађРбђРБеРаиРаџРаЅРаЂРађРађРаЂРаЅРаЉРа▓РбїРБЄРаЦРацРацРацРацРацРбцРагРбёРБЃРАђРађРађРађРађРађ\r\n" + 
					"РађРађРађРађРађРађРАюРађРађРађРађРађРађРађРађРађРбђРБђРацРацРацРацРацРайРбдРБђРађРађРбђРБђРБђРАГРагРбцРБђРБЁРБбРАђРађРађ\r\n" + 
					"РађРађРађРбђРааРБ░РађРађРађРађРађРађРБђРБ░Ра┤РБіРаЦРањРбФРБГРаЅРаЅРаЅРаЅРањРа«РБиРбГРАЮРаХРБЙРБЇРаЅРаЅРаЅРањРаХРа»РБдРађ\r\n" + 
					"РађРађРАаРаЂРаєРАЄРађРађРађРађРбаРАЙРаќРањРаІРаЉРаѕРБ┤РБ┐РБЈРБ┐РБєРађРађРађРађРаѕРаЂРађРБЙРБ┐РБ╗РБ┐РАёРађРађРађРађРаѕРаЃ\r\n" + 
					"РађРА░РаЁРађРађРаЂРађРађРађРађРађРаЅРаЅРБЉРаёРАђРађРб╗РаЅРБ┐РБДРаЈРађРађРађРбђРбђРађРађРбЈРБЅРБ┐РА»РаЃРађРађРађРБђРбаРађ\r\n" + 
					"Ра░РаЂРађРађРађРађРађРађРађРађРађРађРађРаѕРаЊРабРаГРБљРБіРБЏРБЂРБђРБђРБђРАцРа┤РаіРаѕРаЅРаЂРаЅРаЅРађРађРађРађРбђРаѓРаЂРађ\r\n" + 
					"РАЃРаёРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаЂРађРађРађРбђРБаРаћРаџРађРађРађРааРбёРБђРБѓРБђРБђРАаРАёРаѓРаЂРађРађРађ\r\n" + 
					"РАиРањРањРа▓РБёРааРађРађРађРађРађРађРађРађРађРађРађРађРањРаЅРаЅРађРађРађРађРађРађРађРађРаїРаЂРаљРађРађРаѕРа▒РАђРађРађРађ\r\n" + 
					"РбиРАђРађРађРаѕРБЄРађРађРађРбёРБђРБђРБђРБђРађРаёРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРа╝РађРађРађ\r\n" + 
					"РаЄРб│РађРађРбЅРбИРађРАђРбаРАЃРађРађРбђРБђРаЅРаЉРањРацРацРбёРБђРБђРАњРађРађРађРађРађРађРађРађРађРађРаѓРБљРБаРацРабРађРађ\r\n" + 
					"РаЃРаўРАєРађРађРбИРАєРађРађРА│РАђРађРаѕРабРБѕРаЂРањРабРацРбёРБђРађРаѕРаЅРаЅРаЅРањРањРањРањРањРањРаЅРаЅРађРбђРАаРаљРађРађ\r\n" + 
					"РАёРађРБДРађРађРааРаиРаќРањРабРБЎРабРБђРађРађРаЅРањРааРаёРБђРађРађРаѕРаЅРаЂРаљРаљРањРањРањРањРањРаѓРаЅРаЅРађРађРађРађРађ\r\n" + 
					"РБљРБцРаЊРађРађРађРађРађРађРађРА╝РађРаѕРаЎРа▓РацРБёРБђРАђРађРађРаЅРаЂРањРаѓРааРацРацРацРацРацРацРацРацРацРбєРађРађ  РађРађРађРађРађ\r\n" + 
					"РађРБ┐РаЄРађРађРађРађРађРађРађРа╝РБІРБЎРБЏРАњРањРањРањРањРањРањРањРањРБњРБњРайРаФРбђРађРађРађРађРађРађРађРађРађРађРађРађ\r\n" + 
					"РађРбиРБЁРАђРбђРАђРађРађРађРБђРбђРАЙРаѕРађРаЅРаЅРаЅРаЅРаЅРаЅРаЅРаЅРаЅРаЂРађРађРађРађРаѕРабРАђРађРађРађРађРађРађРађ­ЪЉЇ­ЪЉЇ­ЪЉЇ­ЪЉЇ­ЪЉЇ­ЪЉЇРађРађ\r\n" + 
					"РБђРБ║РБђРБЅРБЎРБЎРБЏРБњРБџРБЈРБЅРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБђРБѕРАёРађРађРађРађРађ­ЪЉЇ­ЪЉЇ­ЪЉЇ­ЪЉЇ­ЪЉЇ­ЪЉЇРађ\r\n" + 
					"");
			
		

			
		} catch (Exception e) {
			System.out.println("[DispatcherServlet] handlerMapper Ж░ђ ВІцьїеьќѕВіхвІѕвІц.");
			
			System.out.println("РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРб╗РбиРБиРББРађРађРађРађРађРађРађРађРађ\r\n" + 
					"РађРађРађРађРађРађРађРБђРБђРБђРАђРађРађРађРађРађРађРађРбЈРБ┐РБ┐РАхРАђРађРађРађРађРађРађРађ\r\n" + 
					"РађРађРађРађРБаРБ«РБиРБ┐РБ┐РБ┐РБ┐РБиРБёРБёРађРађРађРађРаѕРбъРБ┐РБ┐РАхРАђРађРађРађРађРађ\r\n" + 
					" РађРађРАаРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБДРБЈРбдРБцРАђРађРађРађРаФРБ╗РБ┐РБЙРбёРађРађРађ\r\n" + 
					" РађРБћРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐Ра┐РБ┐Ра╗РбЪРБ┐РБ┐РБ┐РБ┐РБ┐РАєРађРађРађРаЉРА┐РБ┐РБ»РбєРађРађ\r\n" + 
					" Рб░РБИРб┐РБ╗РбЪРаЃРаЅРаЅРађРАаРацРаИРБИРБ┐РБ┐РБ┐РА│РаЂРађРађРађРађРАеРа║Ра┐РаЄРбЊРАё\r\n" + 
					" РаДРаіРаЂРаўРБќРБ│РааРБХРБІРА╣РаЂРађРаЏРБЕРб╗РаІРађРађРађРађРађРбђРаЄРађРађРађРађРбЙРађ\r\n" + 
					"РађРађРбаРаѓРаЂРаЊРањРаіРађРАаРацРАђРбаРађРаџРађРађРађРађРађРАаРаіРбђРацРАцРБћРаЕРа╝РАђ\r\n" + 
					"РађРађРбЄРађРађРбђРАаРбћРБфРааРаќРаЄРАўРађРађРађРбђРаёРањРаЅРбђРаћРаЂРађРБДРбъРа«РаГРахРАђ\r\n" + 
					"РађРађРаўРањРаЅРБЙРБђРБђРађРБђРБђРадРаЌРа╣РаЎРаЃРаЂРађРАаРаћРААРаћРањРаЅРАеРб┤Рб╣РБ┐РБЈРАє\r\n" + 
					"РађРађРађРађРАИРаЅРађРађРаЂРађРађРађРађРБЄРАаРАёРАХРа»РаћРаѕРађРађРАаРаіРађРађРА┐РБ┐РБ┐РАЄ ­ЪЉј­ЪЉј­ЪЉј­ЪЉј­ЪЉј­ЪЉј­ЪЉј \r\n" + 
					"РађРађРађРбђРаЄРађРађРађРађРбђРБђРацРАцРахРаіРбИРађРАаРацРацРаљРаЅРађРађРађРађРБиРБ┐Рб┐РАЄ ­ЪЉј­ЪЉј­ЪЉј­ЪЉј­ЪЉј­ЪЉј­ЪЉј\r\n" + 
					"РађРађРбђРаЃРађРбђРБђРБђРБђРБаРБђРБђРБ┐РаЅРаЅРаЅРаЅРађРађ");
			e.printStackTrace();
		}
		
	}
	
	
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		requestPro(request, response);
	}

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		requestPro(request, response);
	}
	
	private void requestPro(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {

		// ВѓгВџЕВъљ URI Ж▓ђВХю
		String command = request.getRequestURI(); // contextPath ьЈгьЋе.
		if (command.indexOf(request.getContextPath()) == 0) { // contextPath ВѓГВаю
			command = command.substring(request.getContextPath().length());
		}
		
		//commandHandler ВІцьќЅ (HandlerMapper ВЮўвб░  action ьЋавІ╣)
		Action action = null;
		String view = null;
		
		if (handlerMapper != null){
			action = handlerMapper.getAction(command);
			if(action!=null) { //Вўгв░ћвЦИ ВџћВ▓Г
				
				try {
					view = action.process(request, response);
					if (view == null) {
						return;
					}
					
					request.setAttribute("viewName", view);
					
					JSPViewResolver.view(request, response);
					
					
				} catch (Exception e) {					
					e.printStackTrace();
					//Exception В▓ўвдг
					response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);					
				}
				
			}else {
				response.sendError(HttpServletResponse.SC_NOT_FOUND);
			}	
		}else {
			response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
		}
		
	}

}












